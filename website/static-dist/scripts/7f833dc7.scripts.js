(function(){var a;a=angular.module("energyMonitor",["ngRoute"]),a.config(["$routeProvider",function(a){return a.when("/",{templateUrl:"/views/chart.html"}).otherwise({redirectTo:"/"})}])}).call(this),function(){var a;a=angular.module("energyMonitor"),a.service("ReadingService",["$http","$q",function(a,b){var c;return c="",{getMeters:function(){var d;return d=b.defer(),a.get(""+c+"/api/v1/meter").success(function(a){return d.resolve(a.meters)}).error(function(){return d.reject("Unable to obtain the meters.")}),d.promise},getPulses:function(d,e,f){var g,h;return g=b.defer(),h={},e&&(h.start=e),f&&(h.end=f),a.get(""+c+"/api/v1/pulses/"+d,{params:h}).success(function(a){return g.resolve(a)}).error(function(){return g.reject("Unable to obtain the meter pulses.")}),g.promise},getPulsesByDuration:function(d,e,f,g){var h,i;return h=b.defer(),i={},f&&(i.start=f),g&&(i.end=g),a.get(""+c+"/api/v1/usage/"+d+"/"+e,{params:i}).success(function(a){return h.resolve(a)}).error(function(){return h.reject("Unable to obtain the meter pulses per duration.")}),h.promise},getCurrentPower:function(){var d;return d=b.defer(),a.get(""+c+"/api/v1/readings/last").success(function(a){return d.resolve(a.meters)}).error(function(){return d.reject("Unable to obtain the meters.")}),d.promise}}}])}.call(this),function(){var a;a=angular.module("energyMonitor"),a.controller("EnergyChartController",["$scope","$interval","ReadingService",function(a,b,c){var d;return a.duration=60,a.meters={},a.period={start:null,end:null},Highcharts.setOptions({global:{useUTC:!1}}),d=new Highcharts.StockChart({chart:{renderTo:"container"},navigator:{adaptToUpdatedData:!1},title:{text:"Energy overview (times in UTC)"}}),c.getMeters().then(function(e){var f,g,h,i,j;for(f=function(b){var e,f;return a.meters[b.id]=b,f=d.addSeries({name:b.description}),e=a.duration,c.getPulsesByDuration(b.id,a.duration,a.period.start,a.period.end).then(function(c){var d,g,h,i;for(i=c.data,g=0,h=i.length;h>g;g++)d=i[g],f.setData([d[0],d[1]*b.currentFactor/e]);return(!a.period.start||c.start<a.period.start)&&(a.period.start=c.start),!a.period.end||c.end>a.period.end?a.period.end=c.end:void 0})},g=function(){},i=0,j=e.length;j>i;i++)h=e[i],f(h);return g(),b(g,5e3)})}])}.call(this),angular.module("energyMonitor").run(["$templateCache",function(a){"use strict";a.put("/views/chart.html",'<div ng-controller=EnergyChartController><div id=container style="width: 100%; height: 400px"></div></div>')}]);