(function(){var a;a=angular.module("energyMonitor",["ngRoute","ngMaterial"]),Highcharts.setOptions({global:{useUTC:!1}}),a.config(["$routeProvider",function(a){return a.when("/",{templateUrl:"/views/chart.html"}).otherwise({redirectTo:"/"})}])}).call(this),function(){var a;a=angular.module("energyMonitor"),a.service("ReadingService",["$http","$q",function(a,b){var c;return c="",{getMeters:function(){var d;return d=b.defer(),a.get(""+c+"/api/v1/meter").success(function(a){return d.resolve(a.meters)}).error(function(){return d.reject("Unable to obtain the meters.")}),d.promise},getPulses:function(d,e,f){var g,h;return g=b.defer(),h={},e&&(h.start=e),f&&(h.end=f),a.get(""+c+"/api/v1/pulses/"+d,{params:h}).success(function(a){return g.resolve(a)}).error(function(){return g.reject("Unable to obtain the meter pulses.")}),g.promise},getUsageByDuration:function(d,e,f,g){var h,i;return h=b.defer(),i={},f&&(i.start=f),g&&(i.end=g),a.get(""+c+"/api/v1/usage/"+d+"/"+e,{params:i}).success(function(a){return h.resolve(a)}).error(function(){return h.reject("Unable to obtain the meter usage per duration.")}),h.promise},getCostByDuration:function(d,e,f,g){var h,i;return h=b.defer(),i={},f&&(i.start=f),g&&(i.end=g),a.get(""+c+"/api/v1/cost/"+d+"/"+e,{params:i}).success(function(a){return h.resolve(a)}).error(function(){return h.reject("Unable to obtain the meter cost per duration.")}),h.promise},getCurrentPower:function(){var d;return d=b.defer(),a.get(""+c+"/api/v1/readings/last").success(function(a){return d.resolve(a.meters)}).error(function(){return d.reject("Unable to obtain the meters.")}),d.promise}}}])}.call(this),function(){var a;a=angular.module("energyMonitor"),a.controller("EnergyChartController",["$scope","$interval","ReadingService",function(a,b,c){return a.meters=[],a.today=new Date,a.yesterday=new Date(a.today.getTime()-864e5),c.getMeters().then(function(b){return a.meters=b})}])}.call(this),function(){"use strict";var a;a=angular.module("energyMonitor"),a.directive("emChart",["$filter","$mdTheming",function(a){var b;return b={main:{id:"main"},alt:{id:"alt",type:"spline",color:"rgba(31,31,31,.5)"}},{restrict:"E",scope:{title:"@emTitle",meter:"&emMeter",date:"&emDate",altDate:"&emAltdate",interval:"&emInterval"},link:function(b,c){var d;return d=c[0],b._chart=new Highcharts.StockChart({chart:{renderTo:d,type:"areaspline"},credits:{enabled:!1},rangeSelector:{enabled:!1},tooltip:{shared:!0,formatter:function(){var b,c,d,e,f;for(c="<b>"+a("date")(this.x,"shortTime")+"</b>",f=this.points,d=0,e=f.length;e>d;d++)b=f[d],c+="<br/>"+b.series.name+": "+b.y;return c}},plotOptions:{areaspline:{fillOpacity:.5}}})},controller:["$scope","ReadingService",function(c,d){var e,f,g,h,i;return e={},h=function(f,g){var h,i,j,k,l;if(h=c._chart,l=h.get(f),k=c.meter(),g&&k){if(null==l&&(l=h.addSeries(angular.extend({},b[f],{name:a("date")(g,"shortDate")}))),g=new Date(g.getTime()),g.setHours(0),g.setMinutes(0),g.setSeconds(0),g.setMilliseconds(0),j=c.interval()||60,!(i=g.getTime()))return null!=l?l.remove(!0):void 0;if(i!==e[f])return e[f]=g.getTime(),d.getUsageByDuration(k.id,j,g).then(function(a){var b,c;return c=g.getTime(),l.setData(function(){var d,e,f,g;for(f=a.data,g=[],d=0,e=f.length;e>d;d++)b=f[d],g.push([b[0]-c,Math.round(b[1]*k.currentFactor/j)]);return g}())},function(){return l.setData([])})}},f=function(){var a;if(a=c._chart){for(;a.series.length;)a.series[0].remove(!0);return i(),g()}},i=function(){return h("main",c.date()||new Date)},g=function(){return h("alt",c.altDate())},c.getTitle=function(){var a;return c.title||(null!=(a=c.meter())?a.description:void 0)||""},c.$watch("getTitle()",function(a){var b;return null!=(b=c._chart)?b.setTitle({text:a}):void 0}),c.$watch("meter()",function(){return f()}),c.$watch("date()",function(){return i()}),c.$watch("altDate()",function(){return g()})}]}}])}.call(this),angular.module("energyMonitor").run(["$templateCache",function(a){"use strict";a.put("/views/chart.html",'<div ng-controller=EnergyChartController><md-tabs md-selected=selectedIndex><md-tab label={{meter.description}} ng-repeat="meter in meters"><em-chart em-date=today em-meter=meter em-title=Today style="width: 100%; height: 400px"></em-chart></md-tab></md-tabs></div>')}]);